---
title: "Thesis Workflow"
author: "Neil Kester"
date: "4/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,messages=FALSE)
```

# Purpose  

# Preparation

## Create a Simulation and Entity Table  

First, it is useful to understand information about the sensors and the entities that carried them in the specific "Design Point" and "Iteration" under evaluation. First, lets load the required query and connection object information and then execute the function.   

```{r}

source("./connectionObjects/entityMappingConnectionObj.R")

entitySensorMapping <- modSim::mapSensorsAndEntities(mongoUri = mongoUri,
                              mongoDb = mongoDb,
                              mongoCollection = sensorIDNameCollection,
                              mongoFields = sensorIDNameFields,
                              mongoQuery = sensorIDNameQuery)


```  


### Sensory Description  

```{r}

entitySensorMapping$SensorDescription

```  

### Entity ID to Entity Name  

```{r}

entitySensorMapping$EntityIdToName

```

### Sensor ID to Entity ID  

```{r}

entitySensorMapping$SensorToEntityId

```

### Unnested Sensor State 

This is the full data set produced by the input query.  

```{r}

entitySensorMapping$UnnestedSensorState

```
























## Create a Line of Sight Table  

This table describes when a sensor target has Line of Sight (LOS). This does not mean they have acquired each other but rather that their line of sight is not obstructed.  

```{r}

source("./connectionObjects/hasLosConnectionObj.R")

LosData <- modSim::mongoUnnest(mongoUri = mongoUri,
                               mongoDb = mongoDb,
                               mongoCollection = losMongoCollection,
                               mongoQuery = losMongoQuery,
                               mongoFields = losMongoFields,
                               unnestCols = "event")

```  

```{r}

LosData

```

## Sensor Target Acquisitions

Unlike the LOS table, this table shows the state of acquisition between each sensor target pair. It also shows the previous acquisition state so we can determine when the acquistion level changes.  

```{r}

source("./connectionObjects/acqConnectionObj.R")

sensorAcq <- modSim::sensorAcquisition(mongoUri = mongoUri,
                          mongoDb = mongoDb,
                          mongoCollection = acqMongoCollection,
                          mongoQuery = acqMongoQuery,
                          mongoFields = acqMongoFields,
                          recursiveUnnests = c("event",
                                               "messageData", 
                                               "any", 
                                               "sensorDetection"))
```



# Compile Tables  

Using the reference tables created in last section, we will transform them into useful information.  

```{r}





```









